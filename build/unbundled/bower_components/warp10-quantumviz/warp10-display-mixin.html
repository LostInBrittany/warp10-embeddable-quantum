<html><head><link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html"><link rel="import" href="../warp10-iron/warp10-color-tools.html"><link rel="import" href="./quantumviz-tools.html"><script>const Warp10DisplayMixin=(a)=>class extends Polymer.mixinBehaviors([Polymer.IronResizableBehavior],a){static get properties(){return{data:{type:Object,notify:!0,observer:'dataChanged'},currentValues:{type:Object,notify:!0,observer:'currentValuesChanged'},lineWidth:{type:Number,value:1.75},hideAxis:{type:Boolean,value:!1},hideTooltip:{type:Boolean,value:!1},showLegend:{type:Boolean,value:!1},timeBounds:{type:Object,notify:!0},valueBounds:{type:Object,notify:!0},chartArea:{type:Array,notify:!0},timezone:{type:String},tooltip:{type:String,observer:'tooltipChanged',notify:!0,value:''},yLowerBound:{type:Number},yUpperBound:{type:Number},timestamps:{type:Boolean,value:!1},debug:{type:Boolean,value:!0},_params:{type:Object,value:function(){return{}}},_MIN_LINE_WIDTH:{type:Number,value:1},_MAX_LINE_WIDTH:{type:Number,value:20},_DEFAULT_WIDTH:{type:Number,value:480},_DEFAULT_HEIGHT:{type:Number,value:320}}}static get observers(){return['dataChanged(data.*, timestamps)']}ready(){super.ready(),this.addEventListener('iron-resize',(a)=>this._onIronResize(a)),this.addEventListener('resize',(a)=>this._onIronResize(a))}connectedCallback(){super.connectedCallback(),Polymer.RenderStatus.beforeNextRender(this,()=>{this.debug&&console.log('[warp10-display-mixin] connectedCallback -  clientHeight',this.clientHeight),this.configure(),this.isReady=!0,null!==this.data&&this.dataChanged()})}_onIronResize(){this.debug&&console.log('[warp10-display-mixin] _onIronResize - OMG, I got resized!')}dataChanged(){if(!this.isReady)return;let a=this;this._debouncer=Polymer.Debouncer.debounce(this._debouncer,Polymer.Async.timeOut.after(100),()=>{a.debug&&console.log('[warp10-display-mixin] dataChanged() - ',a.data),a._dataToChart()})}configure(){this.debug&&console.log('[warp10-display-mixin] configure'),0===this.clientWidth&&this.updateStyles({"--default-width":this._DEFAULT_WIDTH+'px'}),0===this.clientHeight&&this.updateStyles({"--default-height":this._DEFAULT_HEIGHT+'px'}),this.updateStyles({"--tooltip-width":Math.max(400,2*this.getChart().getBoundingClientRect().width/3).toString()+'px'}),(this.lineWidth<this._MIN_LINE_WIDTH||this.lineWidth>this._MAX_LINE_WIDTH)&&(this.lineWidth=1.5),this.debug&&console.log('[warp10-display-mixin] configure -lineWidth',this.lineWidth)}_removeChartData(){this.debug&&console.log('[warp10-display-mixin] _removeChartData'),this.chart&&(this.chart.destroy(),this.chart=null)}_dataToChart(){var a=Math.floor;if(this.debug&&console.log('[warp10-display-mixin] _dataToChart',{data:this.data}),!this.data)return this.debug&&console.log('[warp10-display-mixin] No data'),void this._removeChartData();if('string'===typeof this.data&&(this.data=looseJSON.parse(this.data),Array.isArray('array'===this.data)&&(this.data=this.data[0]),this.debug&&console.log('[warp10-display-chart] _dataToChart - Data from String',this.data)),!quantumvizGts.isValidResponse(this.data))return void this._removeChartData();let b={};b=quantumvizGts.getValidResponse(this.data),this.debug&&console.log('[warp10-display-mixin] _dataToChart - Data to plot',b);let c=quantumvizGts.getGtsListRange(b.gts);this.timeBounds=this.timestamps?{min:c[0],max:c[1]}:{min:new Date(a(c[0]/1e3)),max:new Date(a(c[1]/1e3))},this.debug&&console.log('[warp10-display-mixin] _dataToChart - timeBounds',this.timeBounds);let d={gts:[],params:[],globalParams:b.globalParams};for(let a=0;a<b.gts.length;a++)this.debug&&console.log('[warp10-display-mixin] _dataToChart - gtsTools.isGtsToPlot',gtsTools.isGtsToPlot(b.gts[a]),b.gts[a]),gtsTools.isGtsToPlot(b.gts[a])&&(d.gts.push(b.gts[a]),d.params.push(b.params[a]));return this.debug&&console.log('[warp10-display-mixin] _dataToChart - Filtered data to plot',d),0===d.gts.length?void this._removeChartData():void(this._getParamsFromData(d),this._dataToChartLib(d))}_getParamsFromData(a){let b=[],c=[],d=[],e=[];for(let f=0;f<a.params.length;f++){if(this.debug&&(console.log('[warp10-display-mixin]  quantumvizObj.gts',a.gts[f]),console.log('[warp10-display-mixin]  quantumvizObj.params',a.params[f])),void 0!==a.gts[f].a){let b=a.gts[f].a;for(let c in b)b.hasOwnProperty(c)&&0<=['string','number'].indexOf(typeof b[c])&&c.startsWith('quantum-')&&(a.params[f][c.replace('quantum-','')]=b[c])}if(void 0!==a.gts[f].a&&void 0!==a.gts[f].a.quantumParams){let b=a.gts[f].a.quantumParams;for(let c in'string'===typeof a.gts[f].a.quantumParams&&(b=looseJSON.parse(a.gts[f].a.quantumParams)),b)b.hasOwnProperty(c)&&(a.params[f][c]=b[c])}void 0===a.params[f].key?(this.debug&&console.log('[warp10-display-mixin] _dataToChart -  key',a.gts[f]),b[f]=gtsTools.serializeGtsMetadata(a.gts[f])):b[f]=a.params[f].key,c[f]=void 0===a.params[f].color?warp10ColorTools.getColor(f):a.params[f].color,d[f]=void 0===a.params[f].interpolate?void 0===a.globalParams.interpolate?'line':a.globalParams.interpolate:a.params[f].interpolate,e[f]=void 0===a.params[f].strokeWidth?void 0===a.globalParams.lineWidth?this.lineWidth:a.globalParams.strokeWidth:a.params[f].strokeWidth}let f=a.globalParams.xLabel,g=a.globalParams.yLabel,h=a.globalParams.tickList;this._params={labels:b,colors:c,interpolate:d,strokeWidth:e,xlabel:f,ylabel:g,tickList:h},this.debug&&console.log('[warp10-display-mixin] _dataToChart - _params',a.globalParams,this._params),a.globalParams.timestamps&&(this.timestamps=!0)}};</script></head><body></body></html>